<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sticky Note Pads</title>
    <script src="https://miro.com/app/static/sdk/v2/miro.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #f8fafc; 
            padding: 20px;
            max-width: 350px;
        }
        
        h1 {
            font-size: 20px;
            color: #1e293b;
            margin-bottom: 20px;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 12px;
        }
        
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 12px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 12px;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        .notepad-top { 
            cursor: pointer; 
            padding: 20px; 
            background: #fef08a;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #eab308;
            transition: all 0.2s;
            margin: 10px 0;
        }
        
        .notepad-top:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .status-message { 
            margin-top: 12px; 
            font-size: 12px; 
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }
        
        .status-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .status-error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .color-preview {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <h1>üìù Sticky Note Pads</h1>
    <div>
        <textarea id="noteText" placeholder="Enter your note text..." rows="3"></textarea>
        
        <select id="colorSelect">
            <option value="yellow">üü° Yellow</option>
            <option value="green">üü¢ Green</option>
            <option value="blue">üîµ Blue</option>
            <option value="red">üî¥ Red</option>
            <option value="orange">üü† Orange</option>
            <option value="violet">üü£ Violet</option>
            <option value="light_blue">üîµ Light Blue</option>
        </select>
        
        <button id="createBtn">Create Notepad Stack</button>
    </div>
    
    <div id="stackArea"></div>
    <div class="status-message" id="statusMsg"></div>

    <script>
        let noteText = '';
        let selectedColor = 'yellow';
        let isPlacing = false;
        
        const noteTextInput = document.getElementById('noteText');
        const colorSelect = document.getElementById('colorSelect');
        const createBtn = document.getElementById('createBtn');
        const stackArea = document.getElementById('stackArea');
        const statusMsg = document.getElementById('statusMsg');

        function showStatus(message, type) {
            statusMsg.textContent = message;
            statusMsg.className = `status-message status-${type}`;
            
            if (type === 'success') {
                setTimeout(() => {
                    statusMsg.textContent = '';
                    statusMsg.className = 'status-message';
                }, 3000);
            }
        }

        function updateColorPreview() {
            const colorMap = {
                'yellow': '#fef08a',
                'green': '#bbf7d0', 
                'blue': '#bfdbfe',
                'red': '#fecaca',
                'orange': '#fed7aa',
                'violet': '#e9d5ff',
                'light_blue': '#e0f2fe'
            };
            
            if (stackArea.querySelector('.notepad-top')) {
                stackArea.querySelector('.notepad-top').style.backgroundColor = colorMap[selectedColor];
            }
        }

        colorSelect.addEventListener('change', () => {
            selectedColor = colorSelect.value;
            updateColorPreview();
        });

        createBtn.addEventListener('click', () => {
            noteText = noteTextInput.value.trim();
            if (!noteText) {
                showStatus('Please enter note text.', 'error');
                return;
            }
            showStack();
            showStatus('Notepad created! Click to place notes on board.', 'success');
        });

        function showStack() {
            stackArea.innerHTML = '';
            
            const colorMap = {
                'yellow': '#fef08a',
                'green': '#bbf7d0', 
                'blue': '#bfdbfe',
                'red': '#fecaca',
                'orange': '#fed7aa',
                'violet': '#e9d5ff',
                'light_blue': '#e0f2fe'
            };
            
            const top = document.createElement('div');
            top.className = 'notepad-top';
            top.style.backgroundColor = colorMap[selectedColor];
            top.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 8px;">üìù Click to Place</div>
                <div style="font-size: 12px; opacity: 0.7;">${noteText.substring(0, 50)}${noteText.length > 50 ? '...' : ''}</div>
            `;
            top.addEventListener('click', placeNote);
            stackArea.appendChild(top);
        }

        async function placeNote() {
            if (isPlacing) return;
            
            isPlacing = true;
            showStatus('Placing note on board...', 'success');

            try {
                // Get user info from Miro
                const userInfo = await miro.board.getUserInfo();
                const userName = userInfo.name || 'Unknown User';
                const timestamp = new Date().toLocaleString();
                
                // Create content with user attribution
                const finalContent = `${noteText}

üìù ${userName}
üïí ${timestamp}`;

                // Create sticky note using Miro SDK v2
                await miro.board.createStickyNote({
                    content: finalContent,
                    style: {
                        fillColor: selectedColor,
                        textAlign: 'left',
                        textAlignVertical: 'top'
                    },
                    x: 0,
                    y: 0,
                    width: 200,
                    height: 200
                });

                showStatus('‚úÖ Sticky note placed on board!', 'success');
                
            } catch (err) {
                console.error('Error placing note:', err);
                
                // Fallback without user info
                try {
                    const timestamp = new Date().toLocaleString();
                    const fallbackContent = `${noteText}

üïí ${timestamp}`;

                    await miro.board.createStickyNote({
                        content: fallbackContent,
                        style: {
                            fillColor: selectedColor,
                            textAlign: 'left',
                            textAlignVertical: 'top'
                        },
                        x: 0,
                        y: 0,
                        width: 200,
                        height: 200
                    });

                    showStatus('‚úÖ Sticky note placed!', 'success');
                } catch (finalErr) {
                    console.error('Final error:', finalErr);
                    showStatus('‚ùå Error placing sticky note', 'error');
                }
            }
            
            isPlacing = false;
        }

        // Initialize when Miro SDK is ready
        if (typeof miro !== 'undefined') {
            miro.onReady(() => {
                console.log('Miro SDK is ready');
                showStatus('Connected to Miro board', 'success');
                
                // Add toolbar integration
                miro.board.ui.on('icon:click', () => {
                    miro.board.ui.openPanel({
                        url: window.location.href,
                        width: 350,
                        height: 600
                    });
                });
            });
        } else {
            // Demo mode
            window.addEventListener('load', () => {
                showStatus('Demo mode - Miro SDK not loaded', 'error');
            });
        }
    </script>
</body>
</html>
